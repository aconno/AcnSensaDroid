<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="../html_resources/Rubik.css" rel="stylesheet">
    <link rel="stylesheet" href="../html_resources/materialize_min_new.css">
    <style type="text/css">
    body {
        font-family: 'Rubik', sans-serif;
    }
    </style>
    <link rel="stylesheet" href="../html_resources/newStyles.css">
    <link rel="stylesheet" href="../html_resources/webCounterStyles.css">
    <script src="../html_resources/counter.js" type="text/javascript"></script>
</head>

<body style="background-color:#fafafa">
    <div class="acnact">
        <p>
            <span style="display: block;" class="acnact-value">Count: </span>
            <div id="Wrapper" lang="en-US">
        <div class="animated-counter" id="cnt" data-value="0000000"></div>
    </div>
    </div>
    <div class="acnact-btn-div">
        <input type="button" id="btn" class="acnact-btn" value="">
    </div>
    <script>
    var readingState = -2;
    var buttonCounter = 0;
    var latestAdvId = -1234;
    var BUTTON_PRESSED = 1;
    var BUTTON_NOT_PRESSED = 0;

    function onSensorReadings(json_values) {
        var readingState = null;
        var readingCounter = null;

        JSON.parse(json_values, function(key, value) {
            if (key == "BtnState") {
                readingState = parseInt(value);
            }
            if (key == "TmpCounter") {
                readingCounter = parseInt(value);
            }

        });

        if (readingState != null && readingCounter != null) {
            if (latestAdvId != readingCounter && readingState == BUTTON_PRESSED) {
                latestAdvId = readingCounter
                setCount(++buttonCounter);
                //document.getElementById("count").innerHTML = ++buttonCounter;
                document.getElementById("btn").style.backgroundColor = "rgb(211,211,211)";
            } else if (latestAdvId == readingCounter && readingState == BUTTON_NOT_PRESSED) {
                document.getElementById("btn").style.backgroundColor = "rgb(253,155,39)";
            } else {}
        }

    }

    function onSensorReading(name, value) {

        if (name == "TmpCounter") {
            if (latestAdvId != value) {
                latestAdvId = value;
                setCount(++readingCounter);
                //document.getElementById("count").innerHTML = ++readingCounter;
                document.getElementById("btn").style.backgroundColor = "rgb(211,211,211)";
            } else {
                document.getElementById("btn").style.backgroundColor = "rgb(253,155,39)";
            }
        }

    }

    function setCount(value) {
        console.log(value);
        var cnt = document.getElementById("cnt");
        cnt.setAttribute("data-value", value);
        playCounter();
    }

    playCounter();
    </script>
</body>

</html>